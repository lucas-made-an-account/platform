<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾é£Ÿå¹³å° - æ¶ˆè´¹è€…</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Consumer App Specific Styles */
        .header {
            position: sticky;
            top: 0;
            background: white;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .search-container {
            flex: 1;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 2.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
        }
        
        .search-container i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px;
        }
        
        .filter-btn {
            padding: 0.75rem;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Filter Drawer */
        .filter-drawer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 1001;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .filter-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .close-filter {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 4px;
            color: #666;
        }
        
        .filter-section {
            margin-bottom: 1.5rem;
        }
        
        .filter-section h4 {
            margin-bottom: 0.75rem;
            color: #333;
            font-size: 1rem;
        }
        
        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .filter-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .tag {
            padding: 0.5rem 1rem;
            background: #f0f0f0;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .tag:hover, .tag.active {
            background: #ff6b6b;
            color: white;
        }
        
        .filter-actions {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 1rem 0;
            border-top: 1px solid #eee;
            display: flex;
            gap: 1rem;
        }
        
        .cancel-filter, .apply-filter {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .cancel-filter {
            background: #f0f0f0;
            color: #333;
        }
        
        .apply-filter {
            background: #ff6b6b;
            color: white;
        }
        
        /* Dish Grid */
        .dish-grid {
            padding: 1rem;
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            padding-bottom: 80px; /* Space for bottom nav */
        }
        
        .dish-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* Dish Status Badge */
        .dish-status {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            z-index: 2;
        }
        
        .dish-status.available {
            background: #52c41a;
            color: white;
        }
        
        .dish-status.unavailable {
            background: #ff4d4f;
            color: white;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 80px;
            right: 1rem;
            width: 44px;
            height: 44px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: none;
        }
        
        .back-to-top.visible {
            display: block;
        }
        
        /* Responsive adjustments */
        @media (min-width: 480px) {
            .dish-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .dish-grid {
                grid-template-columns: repeat(3, 1fr);
                max-width: 1200px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <!-- Header with Search and Filter -->
    <header class="header">
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="æœç´¢èœå“æˆ–å¨å¸ˆ..." class="search-input">
            <button class="search-btn" aria-label="search"><i class="fas fa-search"></i></button>
        </div>
        <button class="filter-btn">
            <i class="fas fa-filter"></i>
        </button>
    </header>

    <!-- Filter Drawer (Hidden by default) -->
    <div class="filter-drawer" id="filterDrawer" style="display: none;">
        <div class="filter-header">
            <h3>ç­›é€‰é€‰é¡¹</h3>
            <button class="close-filter">&times;</button>
        </div>
        <div class="filter-content">
            <div class="filter-section">
                <h4>å¯ç”¨æ—¶é—´</h4>
                <div class="filter-options">
                    <label><input type="radio" name="time" value="today"> ä»Šå¤©</label>
                    <label><input type="radio" name="time" value="tomorrow"> æ˜å¤©åŠä»¥å</label>
                </div>
            </div>
            
            <div class="filter-section">
                <h4>é…é€æ–¹å¼</h4>
                <div class="filter-options">
                    <label><input type="checkbox" name="delivery" value="home"> é…é€</label>
                    <label><input type="checkbox" name="delivery" value="pickup"> è‡ªå–</label>
                </div>
            </div>
            
            <div class="filter-section">
                <h4>ä»·æ ¼åŒºé—´</h4>
                <div class="filter-options">
                    <label><input type="radio" name="price" value="0-10"> Â¥0 - Â¥10</label>
                    <label><input type="radio" name="price" value="10-20"> Â¥10 - Â¥20</label>
                    <label><input type="radio" name="price" value="20+"> Â¥20+</label>
                </div>
            </div>
            
            <div class="filter-section">
                <h4>èœç³»ç±»å‹</h4>
                <div class="filter-tags">
                    <span class="tag">å·èœ</span>
                    <span class="tag">ç²¤èœ</span>
                    <span class="tag">æ¹˜èœ</span>
                    <span class="tag">é²èœ</span>
                    <span class="tag">é—½èœ</span>
                    <span class="tag">æµ™èœ</span>
                    <span class="tag">è‹èœ</span>
                    <span class="tag">å¾½èœ</span>
                </div>
            </div>
            
            <div class="filter-section">
                <h4>å¨å¸ˆæ ‡ç­¾</h4>
                <div class="filter-tags">
                    <span class="tag">#çƒ­é—¨</span>
                    <span class="tag">#æ–°ä¸Šæ¶</span>
                    <span class="tag">#é«˜è¯„åˆ†</span>
                    <span class="tag">#é™„è¿‘</span>
                    <span class="tag">#å·²è®¤è¯</span>
                    <span class="tag">#ä¸“ä¸š</span>
                    <span class="tag">#å®¶åº­å¨å¸ˆ</span>
                    <span class="tag">#ç‰¹è‰²</span>
                </div>
            </div>
        </div>
        <div class="filter-actions">
            <button class="cancel-filter">å–æ¶ˆ</button>
            <button class="apply-filter">åº”ç”¨</button>
        </div>
    </div>

    <!-- Main Content - Dish Grid -->
    <main class="dish-grid" id="homePage">
        <!-- Dish cards will be dynamically loaded here -->
    </main>
    <!-- Settings Page (hidden by default) -->
    <section id="settingsPage" style="display:none; padding: 24px 16px 80px 16px;">
        <h2 id="settingsTitle" style="margin-bottom: 24px;">è®¾ç½®</h2>
        <div id="userProfileBox" style="text-align:center;margin-bottom:20px;">
            <img id="settingsAvatar" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="avatar" style="width:64px;height:64px;border-radius:50%;object-fit:cover;display:block;margin:0 auto 8px auto;">
            <input id="settingsAvatarInput" type="file" accept="image/*" style="display:block;margin:0 auto 8px auto;">
            <div style="font-weight:600;font-size:18px;" id="settingsDisplayName">æ˜µç§°</div>
            <input id="settingsDisplayNameInput" type="text" style="width:100%;padding:6px;margin-top:6px;border-radius:6px;border:1px solid #ccc;" placeholder="æ˜µç§°">
            <button type="button" id="saveProfileBtn" style="margin-top:8px;padding:6px 16px;border:none;border-radius:6px;background:#ff6b6b;color:#fff;cursor:pointer;">ä¿å­˜èµ„æ–™</button>
            <span id="profileSaved" style="color:green;display:none;margin-left:10px;">å·²ä¿å­˜ï¼</span>
        </div>
        <form id="settingsForm" autocomplete="off">
            <div style="margin-bottom:20px;">
                <label for="languageSelect" style="font-weight:600;"><i class="fas fa-language"></i> <span id="langLabel">è¯­è¨€</span></label><br>
                <select id="languageSelect" style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ccc;">
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div style="margin-bottom:20px;">
                <label style="font-weight:600;"><i class="fas fa-bell"></i> <span id="notifLabel">é€šçŸ¥</span></label><br>
                <label style="display:inline-flex;align-items:center;margin-top:6px;">
                    <input type="checkbox" id="notifToggle" checked style="width:20px;height:20px;margin-right:8px;">
                    <span id="notifToggleLabel">å¯ç”¨é€šçŸ¥</span>
                </label>
            </div>
            <div style="margin-bottom:20px;">
                <label style="font-weight:600;"><i class="fas fa-shield-alt"></i> <span id="privacyLabel">éšç§</span></label><br>
                <label style="display:inline-flex;align-items:center;margin-top:6px;">
                    <input type="checkbox" id="privacyToggle" style="width:20px;height:20px;margin-right:8px;">
                    <span id="privacyToggleLabel">è´¦å·è®¾ä¸ºç§å¯†</span>
                </label>
            </div>
            <div style="margin-bottom:20px;">
                <label style="font-weight:600;"><i class="fas fa-key"></i> æ›´æ”¹å¯†ç </label><br>
                <input type="password" id="oldPassword" placeholder="æ—§å¯†ç " style="width:100%;padding:6px;margin-top:6px;border-radius:6px;border:1px solid #ccc;">
                <input type="password" id="newPassword" placeholder="æ–°å¯†ç " style="width:100%;padding:6px;margin-top:6px;border-radius:6px;border:1px solid #ccc;">
                <input type="password" id="confirmNewPassword" placeholder="ç¡®è®¤æ–°å¯†ç " style="width:100%;padding:6px;margin-top:6px;border-radius:6px;border:1px solid #ccc;">
                <button type="button" id="changePasswordBtn" style="margin-top:8px;padding:6px 16px;border:none;border-radius:6px;background:#ffa726;color:#fff;cursor:pointer;">æ›´æ”¹å¯†ç </button>
                <span id="passwordSaved" style="color:green;display:none;margin-left:10px;">å¯†ç å·²æ›´æ”¹ï¼</span>
            </div>
            <div style="margin-bottom:20px;">
                <button type="button" id="logoutBtn" style="padding:8px 20px;border:none;border-radius:6px;background:#eee;color:#ff6b6b;font-weight:600;cursor:pointer;"><i class="fas fa-sign-out-alt"></i> <span id="logoutLabel">é€€å‡ºç™»å½•</span></button>
            </div>
        </form>
    </section>
    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>
    <script>
    // Initialize local database if not present
    function initLocalDB() {
        if (!localStorage.getItem('users')) localStorage.setItem('users', '[]');
        if (!localStorage.getItem('dishes')) localStorage.setItem('dishes', '[]');
        if (!localStorage.getItem('orders')) localStorage.setItem('orders', '[]');
        if (!localStorage.getItem('reviews')) localStorage.setItem('reviews', '[]');
    }
    initLocalDB();
    
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Filter drawer functionality
        const filterBtn = document.querySelector('.filter-btn');
        const filterDrawer = document.getElementById('filterDrawer');
        const closeFilter = document.querySelector('.close-filter');
        const cancelFilter = document.querySelector('.cancel-filter');
        const applyFilter = document.querySelector('.apply-filter');
        
        if (filterBtn && filterDrawer) {
            filterBtn.addEventListener('click', () => {
                filterDrawer.style.display = 'block';
            });
        }
        
        if (closeFilter && filterDrawer) {
            closeFilter.addEventListener('click', () => {
                filterDrawer.style.display = 'none';
            });
        }
        
        if (cancelFilter && filterDrawer) {
            cancelFilter.addEventListener('click', () => {
                filterDrawer.style.display = 'none';
            });
        }
        
        if (applyFilter && filterDrawer) {
            applyFilter.addEventListener('click', () => {
                // Apply filter logic here
                filterDrawer.style.display = 'none';
                alert('ç­›é€‰æ¡ä»¶å·²åº”ç”¨');
            });
        }
        
        // Tab switching logic
        const navHome = document.getElementById('navHome');
        const navMy = document.getElementById('navMy');
        const homePage = document.getElementById('homePage');
        const settingsPage = document.getElementById('settingsPage');
        
        if (navHome && navMy && homePage && settingsPage) {
            navHome.addEventListener('click', () => {
                navHome.classList.add('active');
                navMy.classList.remove('active');
                homePage.style.display = '';
                settingsPage.style.display = 'none';
            });
            navMy.addEventListener('click', () => {
                navMy.classList.add('active');
                navHome.classList.remove('active');
                homePage.style.display = 'none';
                settingsPage.style.display = '';
                loadConsumerUser(); // Load user info when opening settings
            });
        }

        // Settings interactivity
        const saveUsernameBtn = document.getElementById('saveUsername');
        if (saveUsernameBtn) {
            saveUsernameBtn.onclick = function() {
                const savedIndicator = document.getElementById('usernameSaved');
                if (savedIndicator) {
                    savedIndicator.style.display = 'inline';
                    setTimeout(() => {
                        savedIndicator.style.display = 'none';
                    }, 1500);
                }
            };
        }
        
        const notifToggle = document.getElementById('notifToggle');
        if (notifToggle) {
            notifToggle.onchange = function(e) {
                alert(e.target.checked ? (currentLang==='zh'?'é€šçŸ¥å·²å¯ç”¨':'Notifications enabled') : (currentLang==='zh'?'é€šçŸ¥å·²å…³é—­':'Notifications disabled'));
            };
        }
        
        const privacyToggle = document.getElementById('privacyToggle');
        if (privacyToggle) {
            privacyToggle.onchange = function(e) {
                alert(e.target.checked ? (currentLang==='zh'?'è´¦å·å·²è®¾ä¸ºç§å¯†':'Account set to private') : (currentLang==='zh'?'è´¦å·å·²è®¾ä¸ºå…¬å¼€':'Account set to public'));
            };
        }

        // Logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.onclick = function() {
                localStorage.removeItem('consumerUser');
                localStorage.removeItem('cookUser');
                alert('å·²é€€å‡ºç™»å½•');
                window.location.href = 'login.html';
            };
        }
        
        // Save Profile (username/nickname)
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        if (saveProfileBtn) {
            saveProfileBtn.onclick = function() {
                const user = JSON.parse(localStorage.getItem('consumerUser') || '{}');
                const displayNameInput = document.getElementById('settingsDisplayNameInput');
                const settingsAvatar = document.getElementById('settingsAvatar');
                const settingsDisplayName = document.getElementById('settingsDisplayName');
                const profileSaved = document.getElementById('profileSaved');
                
                if (displayNameInput && settingsAvatar && settingsDisplayName) {
                    user.displayName = displayNameInput.value.trim();
                    user.avatar = settingsAvatar.src;
                    localStorage.setItem('consumerUser', JSON.stringify(user));
                    
                    // Update users array as well
                    let users = JSON.parse(localStorage.getItem('users') || '[]');
                    const userIndex = users.findIndex(u => u.username === user.username && u.platform === 'consumer');
                    if (userIndex !== -1) {
                        users[userIndex].displayName = user.displayName;
                        users[userIndex].avatar = user.avatar;
                        localStorage.setItem('users', JSON.stringify(users));
                    }
                    
                    settingsDisplayName.textContent = user.displayName;
                    if (profileSaved) {
                        profileSaved.style.display = 'inline';
                        setTimeout(() => { profileSaved.style.display = 'none'; }, 1500);
                    }
                }
            };
        }
        
        // Change Password
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        if (changePasswordBtn) {
            changePasswordBtn.onclick = function() {
                const user = JSON.parse(localStorage.getItem('consumerUser') || '{}');
                const oldPasswordInput = document.getElementById('oldPassword');
                const newPasswordInput = document.getElementById('newPassword');
                const confirmNewPasswordInput = document.getElementById('confirmNewPassword');
                const passwordSaved = document.getElementById('passwordSaved');
                
                if (oldPasswordInput && newPasswordInput && confirmNewPasswordInput) {
                    const oldPass = oldPasswordInput.value;
                    const newPass = newPasswordInput.value;
                    const confirmNew = confirmNewPasswordInput.value;
                    
                    if (!oldPass || !newPass || !confirmNew) {
                        alert('è¯·å¡«å†™æ‰€æœ‰å¯†ç å­—æ®µ');
                        return;
                    }
                    if (oldPass !== user.password) {
                        alert('æ—§å¯†ç ä¸æ­£ç¡®');
                        return;
                    }
                    if (newPass !== confirmNew) {
                        alert('æ–°å¯†ç ä¸¤æ¬¡è¾“å…¥ä¸ä¸€è‡´');
                        return;
                    }
                    
                    user.password = newPass;
                    localStorage.setItem('consumerUser', JSON.stringify(user));
                    
                    // Update users array as well
                    let users = JSON.parse(localStorage.getItem('users') || '[]');
                    const userIndex = users.findIndex(u => u.username === user.username && u.platform === 'consumer');
                    if (userIndex !== -1) {
                        users[userIndex].password = newPass;
                        localStorage.setItem('users', JSON.stringify(users));
                    }
                    
                    if (passwordSaved) {
                        passwordSaved.style.display = 'inline';
                        setTimeout(() => { passwordSaved.style.display = 'none'; }, 1500);
                    }
                    
                    oldPasswordInput.value = '';
                    newPasswordInput.value = '';
                    confirmNewPasswordInput.value = '';
                }
            };
        }

        // Avatar upload
        const settingsAvatarInput = document.getElementById('settingsAvatarInput');
        if (settingsAvatarInput) {
            settingsAvatarInput.onchange = function(e) {
                const file = e.target.files[0];
                const settingsAvatar = document.getElementById('settingsAvatar');
                if (file && settingsAvatar) {
                    const reader = new FileReader();
                    reader.onload = function(evt) {
                        settingsAvatar.src = evt.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };
        }

        // Language switching
        const languageSelect = document.getElementById('languageSelect');
        if (languageSelect) {
            languageSelect.onchange = function(e) {
                currentLang = e.target.value;
                updateLanguageUI();
            };
        }

        // Initialize user profile
        loadConsumerUser();
        
        // Load dishes on page load
        loadDishes();
    });

    // Language switching
    const langMap = {
        zh: {
            navHome: 'ä¸»é¡µ', navMy: 'æˆ‘çš„', settingsTitle: 'è®¾ç½®', langLabel: 'è¯­è¨€', usernameLabel: 'ç”¨æˆ·å', saveBtnLabel: 'ä¿å­˜', usernameSaved: 'å·²ä¿å­˜ï¼', notifLabel: 'é€šçŸ¥', notifToggleLabel: 'å¯ç”¨é€šçŸ¥', privacyLabel: 'éšç§', privacyToggleLabel: 'è´¦å·è®¾ä¸ºç§å¯†', logoutLabel: 'é€€å‡ºç™»å½•',
        },
        en: {
            navHome: 'Home', navMy: 'My', settingsTitle: 'Settings', langLabel: 'Language', usernameLabel: 'Username', saveBtnLabel: 'Save', usernameSaved: 'Saved!', notifLabel: 'Notifications', notifToggleLabel: 'Enable notifications', privacyLabel: 'Privacy', privacyToggleLabel: 'Set account private', logoutLabel: 'Log out',
        }
    };
    let currentLang = 'zh';
    
    function updateLanguageUI() {
        for (const key in langMap[currentLang]) {
            const el = document.getElementById(key);
            if (el) el.textContent = langMap[currentLang][key];
        }
        const usernameSaved = document.getElementById('usernameSaved');
        if (usernameSaved) {
            usernameSaved.textContent = langMap[currentLang].usernameSaved;
        }
    }

    // User profile logic
    function loadConsumerUser() {
        const user = JSON.parse(localStorage.getItem('consumerUser') || '{}');
        const settingsDisplayName = document.getElementById('settingsDisplayName');
        const settingsDisplayNameInput = document.getElementById('settingsDisplayNameInput');
        const settingsAvatar = document.getElementById('settingsAvatar');
        
        if (user.displayName && settingsDisplayName && settingsDisplayNameInput) {
            settingsDisplayName.textContent = user.displayName;
            settingsDisplayNameInput.value = user.displayName;
        }
        if (user.avatar && settingsAvatar) {
            settingsAvatar.src = user.avatar;
        }
    }

    // Function to load and display dishes
    function loadDishes() {
        const dishes = JSON.parse(localStorage.getItem('dishes') || '[]');
        const dishGrid = document.getElementById('homePage');
        
        // Clear existing content
        dishGrid.innerHTML = '';
        
        if (dishes.length === 0) {
            // Add empty message
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'empty-state';
            emptyMessage.innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: #666;">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ½ï¸</div>
                    <h3 style="margin-bottom: 8px; color: #333;">æš‚æ— èœå“</h3>
                    <p>å½“å‰æ²¡æœ‰å¯ç”¨çš„èœå“ï¼Œè¯·ç¨åå†è¯•</p>
                </div>
            `;
            dishGrid.appendChild(emptyMessage);
            return;
        }
        
        // Add dish cards
        dishes.forEach(dish => {
            const dishCard = document.createElement('div');
            dishCard.className = 'dish-card';
            dishCard.innerHTML = `
                <div class="dish-image">
                    <img src="${dish.image}" alt="${dish.name}" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px 8px 0 0;">
                    ${dish.available ? '<div class="dish-status available">å¯é¢„è®¢</div>' : '<div class="dish-status unavailable">æš‚ä¸å¯è®¢</div>'}
                </div>
                <div class="dish-info" style="padding: 12px;">
                    <h3 style="margin: 0 0 4px 0; font-size: 18px; color: #333;">${dish.name}</h3>
                    <p style="margin: 0 0 8px 0; color: #666; font-size: 14px; line-height: 1.4;">${dish.description}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="font-weight: bold; color: #ff6b6b; font-size: 20px;">Â¥${dish.price}</span>
                        <div style="display: flex; align-items: center;">
                            <span style="color: #ffa726; margin-right: 4px;">â˜…</span>
                            <span style="font-size: 14px; color: #666;">${dish.rating.toFixed(1)}</span>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 14px; color: #666; font-weight: 500;">å¨å¸ˆ: ${dish.cook}</span>
                        <span style="font-size: 12px; color: #999; background: #f0f0f0; padding: 2px 6px; border-radius: 10px;">${dish.category}</span>
                    </div>
                    ${dish.pickupTime ? `
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
                            å–é¤æ—¶é—´: ${getPickupTimeText(dish.pickupTime)}
                        </div>
                    ` : ''}
                    <button class="contact-btn" data-dish-id="${dish.id}" style="width: 100%; padding: 8px 16px; background: ${dish.available ? '#ff6b6b' : '#ccc'}; color: white; border: none; border-radius: 6px; cursor: ${dish.available ? 'pointer' : 'not-allowed'}; font-size: 14px; font-weight: 500;" ${!dish.available ? 'disabled' : ''}>
                        ${dish.available ? 'æŸ¥çœ‹è¯¦æƒ…' : 'æš‚ä¸å¯è®¢'}
                    </button>
                </div>
            `;
            dishCard.style.cssText = 'background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 16px; overflow: hidden; position: relative;';
            dishGrid.appendChild(dishCard);
        });
        
        // Add click handlers for contact buttons
        const contactBtns = document.querySelectorAll('.contact-btn');
        contactBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const dishId = e.target.getAttribute('data-dish-id');
                const dish = dishes.find(d => d.id === dishId);
                if (dish && dish.available) {
                    showCookDetails(dish);
                }
            });
        });
    }
    
    // Helper function to format pickup time
    function getPickupTimeText(pickupTime) {
        if (!pickupTime) return '';
        
        if (pickupTime.type === 'lunch') {
            return 'åˆé¤æ—¶æ®µ (11:30-13:00)';
        } else if (pickupTime.type === 'dinner') {
            return 'æ™šé¤æ—¶æ®µ (17:30-19:00)';
        } else if (pickupTime.type === 'custom') {
            return `${pickupTime.start}-${pickupTime.end}`;
        }
        return '';
    }
    
    // Function to show cook details modal
    function showCookDetails(dish) {
        // Create modal backdrop
        const backdrop = document.createElement('div');
        backdrop.style.cssText = `
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 1000;
            display: flex; align-items: center; justify-content: center;
            padding: 20px;
        `;
        
        // Create modal content
        const modal = document.createElement('div');
        modal.style.cssText = `
            background: white; border-radius: 12px; max-width: 400px; width: 100%;
            max-height: 80vh; overflow-y: auto; position: relative;
        `;
        
        modal.innerHTML = `
            <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: #333;">${dish.name}</h3>
                <button id="closeModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
            </div>
            <div style="padding: 20px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="${dish.image}" alt="${dish.name}" style="width: 100%; max-width: 300px; height: 200px; object-fit: cover; border-radius: 8px;">
                </div>
                
                <div style="margin-bottom: 16px;">
                    <h4 style="margin: 0 0 8px 0; color: #333;">èœå“ä¿¡æ¯</h4>
                    <p style="margin: 0 0 8px 0; color: #666;">${dish.description}</p>
                    <p style="margin: 0; font-size: 24px; font-weight: bold; color: #ff6b6b;">Â¥${dish.price}</p>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <h4 style="margin: 0 0 8px 0; color: #333;">å¨å¸ˆä¿¡æ¯</h4>
                    <p style="margin: 0 0 4px 0; color: #666;"><strong>å¨å¸ˆ:</strong> ${dish.cook}</p>
                    <p style="margin: 0 0 4px 0; color: #666;"><strong>è¯„åˆ†:</strong> ${dish.rating.toFixed(1)} â˜…</p>
                    <p style="margin: 0; color: #666;"><strong>èœç³»:</strong> ${dish.category}</p>
                </div>
                
                ${dish.pickupTime ? `
                    <div style="margin-bottom: 16px;">
                        <h4 style="margin: 0 0 8px 0; color: #333;">å–é¤æ—¶é—´</h4>
                        <p style="margin: 0; color: #666;">${getPickupTimeText(dish.pickupTime)}</p>
                        ${dish.sameDayPickup ? '<p style="margin: 4px 0 0 0; color: #52c41a; font-size: 14px;">âœ“ æ”¯æŒå½“æ—¥å–é¤</p>' : '<p style="margin: 4px 0 0 0; color: #ff4d4f; font-size: 14px;">âœ— ä»…æ”¯æŒæ¬¡æ—¥åŠä»¥åå–é¤</p>'}
                    </div>
                ` : ''}
                
                <div style="margin-bottom: 20px;">
                    <h4 style="margin: 0 0 8px 0; color: #333;">è”ç³»æ–¹å¼</h4>
                    <p style="margin: 0 0 8px 0; color: #666;">å¦‚éœ€é¢„è®¢æ­¤èœå“ï¼Œè¯·è”ç³»å¨å¸ˆ:</p>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #ff6b6b;">
                        <p style="margin: 0 0 4px 0; color: #333;"><strong>å¾®ä¿¡:</strong> è¯·æ‰«æå¨å¸ˆäºŒç»´ç </p>
                        <p style="margin: 0; color: #333;"><strong>ç”µè¯:</strong> è¯·æŸ¥çœ‹å¨å¸ˆèµ„æ–™</p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px;">
                    <button id="contactCook" style="flex: 1; padding: 12px; background: #52c41a; color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">
                        è”ç³»å¨å¸ˆ
                    </button>
                    <button id="closeModalBtn" style="flex: 1; padding: 12px; background: #f0f0f0; color: #333; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">
                        å…³é—­
                    </button>
                </div>
            </div>
        `;
        
        backdrop.appendChild(modal);
        document.body.appendChild(backdrop);
        
        // Add event listeners
        document.getElementById('closeModal').onclick = () => document.body.removeChild(backdrop);
        document.getElementById('closeModalBtn').onclick = () => document.body.removeChild(backdrop);
        document.getElementById('contactCook').onclick = () => {
            alert(`è¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»å¨å¸ˆ ${dish.cook}:\n\n1. æŸ¥çœ‹å¨å¸ˆå¾®ä¿¡äºŒç»´ç \n2. æ‹¨æ‰“å¨å¸ˆç”µè¯\n3. ç›´æ¥ä¸å¨å¸ˆåå•†é¢„è®¢è¯¦æƒ…`);
        };
        
        // Close on backdrop click
        backdrop.onclick = (e) => {
            if (e.target === backdrop) {
                document.body.removeChild(backdrop);
            }
        };
    }
    </script>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <div class="nav-item active" id="navHome">
            <i class="fas fa-home"></i>
            <span id="navHomeLabel">ä¸»é¡µ</span>
        </div>
        <div class="nav-item" id="navMy">
            <i class="fas fa-user"></i>
            <span id="navMyLabel">æˆ‘çš„</span>
        </div>
    </nav>
</body>
</html> 